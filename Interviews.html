<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Interview Scheduling</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.43/moment-timezone-with-data.min.js"></script>

    <style>
        /* --- Themes & Variables --- */
        :root {
            --color-bg: #FFF9F2; /* Warm Cream */
            --color-surface: #FFFFFF;
            --color-text: #111111;
            --color-accent: #2B30FF; /* Electric Blue */
            --color-border: #111111;
            --radius-large: 2.5rem; 
            --radius-pill: 999px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }

        /* --- Typography --- */
        h1, h2, h3, h4, .font-serif {
            font-family: 'Playfair Display', serif;
        }

        /* --- Components --- */
        .content-island {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-large);
            padding: 2.5rem;
            position: relative;
            z-index: 10;
        }

        .btn-primary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-text);
            color: #FFFFFF;
            padding: 1rem 2.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: var(--radius-pill);
            transition: all 0.3s ease;
            border: 1px solid var(--color-text);
            cursor: pointer;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(43, 48, 255, 0.4);
            background-color: var(--color-accent);
            border-color: var(--color-accent);
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: var(--color-text);
            padding: 0.75rem 2rem;
            font-weight: 500;
            border-radius: var(--radius-pill);
            border: 1px solid var(--color-border);
            transition: all 0.2s ease;
        }
        
        .btn-secondary:hover {
            background-color: var(--color-text);
            color: #FFFFFF;
        }

        /* Form Elements */
        .form-input, .form-select {
            background-color: #FFFFFF;
            border: 1px solid #D1D5DB;
            color: var(--color-text);
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            width: 100%;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }
        
        input[type="date"].form-input {
            background-image: none;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px rgba(43, 48, 255, 0.1);
        }

        /* Calendar Row Styling */
        .calendar-row {
            border-bottom: 1px solid #F3F4F6;
            transition: all 0.2s ease;
        }
        
        .calendar-row:last-child {
            border-bottom: none;
        }

        .calendar-row.available:hover {
            background-color: #F8FAFC;
        }

        .calendar-row.taken {
            opacity: 0.5;
            background-color: #FAFAFA;
        }

        .book-btn {
            font-weight: 600;
            color: var(--color-accent);
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            transition: all 0.2s;
        }

        .calendar-row.available:hover .book-btn {
            text-decoration: underline;
            transform: translateX(-4px);
        }

        /* Loader animation */
        .loader {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid #ffffff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen pb-20">

    <main class="max-w-3xl mx-auto px-4 pt-12 lg:pt-20">
        
        <!-- Header Section -->
        <section class="mb-12 text-center relative">
            <div class="inline-block border border-gray-900 rounded-full px-4 py-1.5 text-xs font-bold uppercase tracking-wider mb-6 bg-white">
                The Hybrid Work Study (TUM)
            </div>
            <h1 class="text-5xl md:text-6xl font-serif font-medium text-gray-900 mb-6 leading-tight">
                Schedule Your <br><span class="text-[var(--color-accent)] italic">Interview.</span>
            </h1>
            <p class="text-lg text-gray-600 max-w-xl mx-auto">
                Please select a time slot that fits your schedule. <br>The times displayed are automatically converted to your local time zone.
            </p>
        </section>

        <!-- Main Interface -->
        <div class="content-island shadow-xl">
            
            <!-- Controls (Vertical Layout) -->
            <div class="flex flex-col gap-6 mb-10">
                <!-- 1. Time Zone -->
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2 ml-2 tracking-widest">1. Time Zone</label>
                    <div class="relative">
                        <select id="timezone-select" class="form-select text-sm">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                </div>

                <!-- 2. Date -->
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2 ml-2 tracking-widest">2. Select Date</label>
                    <input type="date" id="date-picker" class="form-input text-sm">
                    <p class="text-[10px] text-gray-400 mt-2 ml-2 uppercase tracking-wide">Showing researcher availability for this base date</p>
                </div>

                <!-- 3. Platform -->
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2 ml-2 tracking-widest">3. Platform</label>
                    <select id="platform-select" class="form-select text-sm">
                        <option value="Zoom">Zoom</option>
                        <option value="Microsoft Teams">Microsoft Teams</option>
                        <option value="Both Works">Both works</option>
                    </select>
                </div>
            </div>

            <hr class="border-gray-100 mb-10">

            <!-- Slots (Calendar Layout) -->
            <div>
                <h2 class="text-2xl font-serif font-medium mb-6">Available Slots</h2>
                
                <!-- Calendar Header -->
                <div class="flex justify-between items-center text-xs font-bold uppercase text-gray-400 tracking-widest border-b border-gray-200 pb-2 mb-2 px-4">
                    <span>Time</span>
                    <span>Status</span>
                </div>

                <div id="slots-container" class="flex flex-col">
                    <!-- Slots injected here -->
                    <div class="py-12 text-center text-gray-400 border border-dashed border-gray-300 rounded-2xl mt-4">
                        Loading availability...
                    </div>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <footer class="content-island !bg-black !border-black text-white py-12 px-8 flex flex-col md:flex-row justify-between items-center gap-8 mt-12">
            <div class="text-center md:text-left">
                <h4 class="font-serif font-bold text-xl mb-2">TUM School of Engineering and Design - Chair of Integrated Product Design</h4>
                <p class="text-gray-400 text-sm leading-relaxed">
                    Arcisstr. 21<br>
                    80333 Munich, Germany
                </p>
            </div>
            <div class="flex items-center gap-2">
                <span class="block w-3 h-3 rounded-full bg-[var(--color-accent)] animate-pulse"></span>
                <span class="text-xs text-gray-500 font-mono uppercase tracking-widest">&copy; 2025 ALL RIGHTS RESERVED.</span>
            </div>
        </footer>

    </main>

    <!-- Booking Modal -->
    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" onclick="closeModal()"></div>
        
        <!-- Modal Content -->
        <div class="relative bg-[var(--color-surface)] border border-[var(--color-border)] rounded-[var(--radius-large)] p-8 max-w-md w-full mx-4 shadow-2xl transform scale-95 transition-transform duration-300" id="modal-content">
            
            <div class="text-center mb-8">
                <div class="inline-block p-3 rounded-full bg-blue-50 text-[var(--color-accent)] mb-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                </div>
                <h3 class="font-serif text-3xl font-medium text-gray-900 mb-2">Confirm Booking</h3>
                <p class="text-gray-500 text-sm">Please review your selected time.</p>
            </div>

            <div class="bg-gray-50 rounded-2xl p-6 mb-8 border border-gray-100">
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-center border-b border-gray-200 pb-2 mb-2">
                        <span class="text-xs font-bold uppercase text-gray-400 tracking-wider">Date</span>
                        <span id="modal-date" class="font-medium text-gray-900"></span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold uppercase text-gray-400 tracking-wider">Time</span>
                        <span id="modal-time" class="font-medium text-[var(--color-accent)]"></span>
                    </div>
                </div>
            </div>

            <form id="booking-form" class="space-y-6">
                <div>
                    <label class="block text-xs font-bold uppercase text-gray-500 mb-2 ml-2">Participant Code</label>
                    <input type="text" id="participant-code" placeholder="e.g. HR_001" required 
                        class="form-input">
                    <p class="text-[10px] text-gray-400 mt-2 ml-2">This ensures your anonymity.</p>
                </div>

                <div class="flex gap-4 pt-2">
                    <button type="button" onclick="closeModal()" class="flex-1 btn-secondary text-sm">Cancel</button>
                    <button type="submit" id="submit-btn" class="flex-1 btn-primary text-sm shadow-xl">
                        <span id="btn-text">Confirm</span>
                        <div id="btn-loader" class="loader ml-2 hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Message Modal -->
    <div id="success-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
        <div class="relative bg-[var(--color-surface)] border border-[var(--color-border)] rounded-[var(--radius-large)] p-10 max-w-sm w-full mx-4 shadow-2xl text-center">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6 mx-auto">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h3 class="font-serif text-3xl font-medium text-gray-900 mb-4">Booked!</h3>
            <p class="text-gray-600 mb-8 leading-relaxed">
                Thank you for scheduling. Your request is received. You can close this page now.
            </p>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION AREA
        // ==========================================
        
        const FORMSPARK_ID = "IShFh7sHM";
        const HOST_TIMEZONE = "Europe/Berlin";
        const START_HOUR = 6;  // 6:00 AM Berlin
        const END_HOUR = 20;   // 20:00 (8 PM) Berlin
        
        // Manual Blocking (Berlin ISO Times)
        const bookedSlots = [
            "2026-01-15T06:00:00"
        ];

        // 1. Time Zones (Ordered East to West)
        const COMMON_TIMEZONES = [
            { value: "Pacific/Auckland", label: "(GMT+12:00) Auckland, Wellington" },
            { value: "Pacific/Guadalcanal", label: "(GMT+11:00) Solomon Is., New Caledonia" },
            { value: "Australia/Sydney", label: "(GMT+10:00) Canberra, Melbourne, Sydney" },
            { value: "Asia/Tokyo", label: "(GMT+09:00) Osaka, Sapporo, Tokyo" },
            { value: "Asia/Shanghai", label: "(GMT+08:00) Beijing, Hong Kong, Singapore" },
            { value: "Asia/Bangkok", label: "(GMT+07:00) Bangkok, Hanoi, Jakarta" },
            { value: "Asia/Dhaka", label: "(GMT+06:00) Dhaka" },
            { value: "Asia/Karachi", label: "(GMT+05:00) Islamabad, Karachi" },
            { value: "Asia/Dubai", label: "(GMT+04:00) Abu Dhabi, Muscat" },
            { value: "Europe/Moscow", label: "(GMT+03:00) Moscow, St. Petersburg" },
            { value: "Europe/Helsinki", label: "(GMT+02:00) Helsinki, Kyiv, Riga, Sofia" },
            { value: "Europe/Berlin", label: "(GMT+01:00) Amsterdam, Berlin, Rome, Stockholm" },
            { value: "Europe/London", label: "(GMT+00:00) London, Dublin, Lisbon" },
            { value: "Atlantic/Azores", label: "(GMT-01:00) Azores" },
            { value: "America/Argentina/Buenos_Aires", label: "(GMT-03:00) Buenos Aires" },
            { value: "America/St_Johns", label: "(GMT-03:30) Newfoundland" },
            { value: "America/Halifax", label: "(GMT-04:00) Atlantic Time (Canada)" },
            { value: "America/New_York", label: "(GMT-05:00) Eastern Time (US & Canada)" },
            { value: "America/Chicago", label: "(GMT-06:00) Central Time (US & Canada)" },
            { value: "America/Denver", label: "(GMT-07:00) Mountain Time (US & Canada)" },
            { value: "America/Los_Angeles", label: "(GMT-08:00) Pacific Time (US & Canada)" },
            { value: "America/Anchorage", label: "(GMT-09:00) Alaska" },
            { value: "Pacific/Honolulu", label: "(GMT-10:00) Hawaii" },
            { value: "Pacific/Midway", label: "(GMT-11:00) Midway Island, Samoa" },
            { value: "Etc/GMT+12", label: "(GMT-12:00) International Date Line West" }
        ];

        // ==========================================
        // APPLICATION LOGIC
        // ==========================================

        let selectedSlotIso = null; 
        let selectedSlotDisplay = null;

        const timezoneSelect = document.getElementById('timezone-select');
        const datePicker = document.getElementById('date-picker');
        const slotsContainer = document.getElementById('slots-container');
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-content');
        const bookingForm = document.getElementById('booking-form');

        function init() {
            // 1. Populate Timezones
            const guessedTz = moment.tz.guess();
            let selectedIndex = 11; // Default to Berlin

            COMMON_TIMEZONES.forEach((tz, index) => {
                const option = document.createElement('option');
                option.value = tz.value;
                option.textContent = tz.label;
                timezoneSelect.appendChild(option);
                if (guessedTz.includes(tz.value.split('/')[1])) {
                    selectedIndex = index;
                }
            });
            timezoneSelect.selectedIndex = selectedIndex;

            // 2. Date Limits
            const now = new Date();
            const year = now.getFullYear();
            
            // Min date: Tomorrow
            const tomorrow = moment().add(1, 'days').format('YYYY-MM-DD');
            datePicker.value = tomorrow;
            datePicker.min = tomorrow;

            // Max date: Feb 15th
            let maxDateYear = year;
            const feb15ThisYear = new Date(year, 1, 15);
            if (now > feb15ThisYear) { maxDateYear = year + 1; }
            const maxDate = `${maxDateYear}-02-15`;
            datePicker.max = maxDate;

            renderSlots();
        }

        function renderSlots() {
            slotsContainer.innerHTML = '';
            const userTz = timezoneSelect.value;
            const selectedDateStr = datePicker.value;

            if (!selectedDateStr) return;

            let hasSlots = false;

            for (let hour = START_HOUR; hour < END_HOUR; hour++) {
                
                const slotBerlin = moment.tz(`${selectedDateStr} ${hour}:00`, "YYYY-MM-DD HH:mm", HOST_TIMEZONE);
                
                if (slotBerlin.isBefore(moment())) continue;

                hasSlots = true;
                const slotUserStart = slotBerlin.clone().tz(userTz);
                const slotUserEnd = slotBerlin.clone().add(1, 'hour').tz(userTz);

                const slotId = slotBerlin.format('YYYY-MM-DDTHH:mm:ss');
                const isBooked = bookedSlots.includes(slotId);
                
                const startStr = slotUserStart.format('HH:mm');
                const endStr = slotUserEnd.format('HH:mm');

                const userSlotDate = slotUserStart.format('YYYY-MM-DD');
                let dateBadge = '';
                if (userSlotDate !== selectedDateStr) {
                    const niceDate = slotUserStart.format('ddd, MMM Do');
                    dateBadge = `<span class="text-[10px] uppercase font-bold text-red-500 ml-2">(${niceDate})</span>`;
                }

                // New Calendar Layout (Row Style)
                const div = document.createElement('div');
                div.className = `calendar-row p-4 flex justify-between items-center group ${isBooked ? 'taken' : 'available cursor-pointer'}`;
                
                div.innerHTML = `
                    <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4">
                        <div class="text-lg font-medium font-serif text-gray-900 w-32">
                            ${startStr} <span class="text-gray-400 text-sm">- ${endStr}</span>
                        </div>
                        ${dateBadge}
                    </div>
                    <div>
                        ${isBooked 
                            ? '<span class="text-xs font-bold uppercase text-gray-300">Taken</span>' 
                            : '<span class="book-btn">Select</span>'
                        }
                    </div>
                `;

                if (!isBooked) {
                    const fullDateDisplay = slotUserStart.format('MMMM Do, YYYY');
                    div.onclick = () => openModal(slotId, fullDateDisplay, `${startStr} - ${endStr}`);
                }

                slotsContainer.appendChild(div);
            }

            if (!hasSlots) {
                slotsContainer.innerHTML = `
                    <div class="py-16 text-center border-2 border-dashed border-gray-200 rounded-[2rem] mt-4">
                        <p class="font-serif text-xl text-gray-400 italic mb-2">No availability</p>
                        <p class="text-sm text-gray-400">Please select a different date.</p>
                    </div>`;
            }
        }

        function openModal(isoTime, dateStr, timeRangeStr) {
            selectedSlotIso = isoTime;
            selectedSlotDisplay = `${dateStr} (${timeRangeStr})`;
            
            document.getElementById('modal-date').textContent = dateStr;
            document.getElementById('modal-time').textContent = timeRangeStr;
            
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
        }

        function closeModal() {
            modal.classList.add('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            bookingForm.reset();
        }
        
        window.closeModal = closeModal;

        bookingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('submit-btn');
            const loader = document.getElementById('btn-loader');
            const btnText = document.getElementById('btn-text');
            const code = document.getElementById('participant-code').value;
            const platform = document.getElementById('platform-select').value;

            btn.disabled = true;
            btnText.classList.add('hidden');
            loader.classList.remove('hidden');

            const payload = {
                participant_code: code,
                berlin_time_slot: selectedSlotIso,
                user_local_time: selectedSlotDisplay,
                user_timezone: timezoneSelect.value,
                meeting_platform: platform
            };

            try {
                const response = await fetch(`https://submit-form.com/${FORMSPARK_ID}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Accept": "application/json" },
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    closeModal();
                    document.getElementById('success-modal').classList.remove('hidden');
                } else {
                    alert("Something went wrong. Please try again.");
                }
            } catch (error) {
                console.error(error);
                alert("Error connecting to server.");
            } finally {
                btn.disabled = false;
                btnText.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        });

        timezoneSelect.addEventListener('change', renderSlots);
        datePicker.addEventListener('change', renderSlots);

        init();

    </script>
</body>
</html>
